@using ecomFront.Models.DashboardViewModel


@{
    ViewData["Title"] = "Home Page";
    Layout = "_Layout";
}
@model MainDashboardViewModel
<!-- Page header -->

<div class="page-header page-header-light">
    <div class="breadcrumb-line breadcrumb-line-light header-elements-lg-inline">
        <div class="d-flex">
            <div class="breadcrumb">
                <a asp-area="" asp-controller="Home" asp-action="Index" class="breadcrumb-item"><i class="icon-home2 mr-2"></i> Home</a>
            </div>

            <a href="#" class="header-elements-toggle text-body d-lg-none"><i class="icon-more"></i></a>
        </div>

        <div class="header-elements d-none">
            <div class="breadcrumb justify-content-center">
                <a href="#" class="breadcrumb-elements-item">
                    <i class="icon-comment-discussion mr-2"></i>
                    Necesito Ayuda
                </a>
            </div>
        </div>
    </div>
</div>
<!-- /page header -->

<div class="content">

    <!-- Simple statistics -->
    <!--<div class="mb-2">
            <div class="row">
                <div class="col-sm-12 col-xl-12">
                    <div class="card border-top-2 border-bottom-2 border-top-success border-bottom-success rounded-0">
                        <div class="page-header-content header-elements-lg-inline">
                            <div class="page-title d-flex breadcrumb pt-0 col-4">
                                <h4>Muñecos Impresos en 3D</h4>
                            </div>
                            <div class="border-left border-left-success align-items-center p-1 text-center w-25">
                                <h2 class="font-weight-semibold m-0" id="CantAtributos">3</h2>
                                <span class="font-weight-normal">EJECUCIONES</span>
                            </div>
                            <div class="border-left border-left-success align-items-center p-1 text-center w-25">
                                <h2 class="font-weight-semibold m-0" id="CantAtributos">9.453</h2>
                                <span class="font-weight-normal">VISITAS ANALIZADAS</span>
                            </div>
                            <div class="border-left border-left-success align-items-center p-1 text-center w-25">
                                <h2 class="font-weight-semibold m-0" id="CantAtributos">49.453</h2>
                                <span class="font-weight-normal">COMENTARIOS</span>
                            </div>
                            <div class="border-left border-left-success align-items-center p-1 text-center w-25">
                                <h2 class="font-weight-semibold m-0" id="CantAtributos">4.323</h2>
                                <span class="font-weight-li">PUBLICACIONES</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-sm-6 col-xl-3">
                    <div class="card card-body bg-danger text-white has-bg-image">
                        <div class="media mb-3">
                            <div class="media-body">
                                <h6 class="font-weight-semibold mb-0">Analisis de oportunidad</h6>
                                <span class="opacity-75">Competidores fuertes</span>
                            </div>

                            <div class="ml-3 align-self-center">
                                <i class="icon-pulse2 icon-2x"></i>
                            </div>
                        </div>

                        <div class="progress bg-danger mb-2" style="height: 0.3rem;">
                            <div class="progress-bar bg-white" style="width: 80%">
                                <span class="sr-only">70% Complete</span>
                            </div>
                        </div>

                        <div>
                            <span class="float-right">70%</span>
                            MUY COMPETITIVO
                        </div>
                    </div>
                </div>
                <div class="col-sm-6 col-xl-3">


         <div class="card">
             <div class="card-body p-3">
                 <div class="media mb-0">
                     <div class="media-body align-middle">
                         <h3 class="font-weight-semibold mb-0">$ 2.345,60</h3>
                         <div class="text-muted font-size-sm">dispersión 12%</div>
                     </div>
                     <div class="ml-3">
                         <h5 class="mb-0 ">PRECIO MEDIO</h5>
                     </div>
                 </div>
             </div>
             <div id="line_chart_simple">
                 <svg width="282.3999938964844" height="50">
                     <g transform="translate(0,0)" width="282.3999938964844">
                         <defs>
                             <clipPath id="clip-line-small">
                                 <rect class="clip" width="282.3999938964844" height="50"></rect>
                             </clipPath>
                         </defs>
                         <path d="M20,8.46153846153846L60.39999898274739,25.76923076923077L100.79999796549478,5L141.1999969482422,15.384615384615383L181.59999593098956,5L221.999994913737,36.15384615384615L262.3999938964844,8.46153846153846" clip-path="url(#clip-line-small)" class="d3-line d3-line-medium" style="stroke: rgb(33, 150, 243);">
                         </path>
                         <g>
                             <line class="d3-line-guides" x1="20" y1="50" x2="20" y2="8.46153846153846" style="stroke: rgba(33, 150, 243, 0.5); stroke-dasharray: 4, 2; shape-rendering: crispedges;"></line>
                             <line class="d3-line-guides" x1="60.39999898274739" y1="50" x2="60.39999898274739" y2="25.76923076923077" style="stroke: rgba(33, 150, 243, 0.5); stroke-dasharray: 4, 2; shape-rendering: crispedges;"></line>
                             <line class="d3-line-guides" x1="100.79999796549478" y1="50" x2="100.79999796549478" y2="5" style="stroke: rgba(33, 150, 243, 0.5); stroke-dasharray: 4, 2; shape-rendering: crispedges;"></line>
                             <line class="d3-line-guides" x1="141.1999969482422" y1="50" x2="141.1999969482422" y2="15.384615384615383" style="stroke: rgba(33, 150, 243, 0.5); stroke-dasharray: 4, 2; shape-rendering: crispedges;"></line>
                             <line class="d3-line-guides" x1="181.59999593098956" y1="50" x2="181.59999593098956" y2="5" style="stroke: rgba(33, 150, 243, 0.5); stroke-dasharray: 4, 2; shape-rendering: crispedges;"></line>
                             <line class="d3-line-guides" x1="221.999994913737" y1="50" x2="221.999994913737" y2="36.15384615384615" style="stroke: rgba(33, 150, 243, 0.5); stroke-dasharray: 4, 2; shape-rendering: crispedges;"></line>
                             <line class="d3-line-guides" x1="262.3999938964844" y1="50" x2="262.3999938964844" y2="8.46153846153846" style="stroke: rgba(33, 150, 243, 0.5); stroke-dasharray: 4, 2; shape-rendering: crispedges;"></line>
                         </g>
                         <g>
                             <circle class="d3-line-circle d3-line-circle-medium" cx="20" cy="8.46153846153846" r="3" style="stroke: rgb(33, 150, 243); fill: rgb(33, 150, 243); opacity: 1;"></circle>
                             <circle class="d3-line-circle d3-line-circle-medium" cx="60.39999898274739" cy="25.76923076923077" r="3" style="stroke: rgb(33, 150, 243); fill: rgb(33, 150, 243); opacity: 1;"></circle>
                             <circle class="d3-line-circle d3-line-circle-medium" cx="100.79999796549478" cy="5" r="3" style="stroke: rgb(33, 150, 243); fill: rgb(33, 150, 243); opacity: 1;"></circle>
                             <circle class="d3-line-circle d3-line-circle-medium" cx="141.1999969482422" cy="15.384615384615383" r="3" style="stroke: rgb(33, 150, 243); fill: rgb(33, 150, 243); opacity: 1;">
                             </circle>
                             <circle class="d3-line-circle d3-line-circle-medium" cx="181.59999593098956" cy="5" r="3" style="stroke: rgb(33, 150, 243); fill: rgb(33, 150, 243); opacity: 1;"></circle>
                             <circle class="d3-line-circle d3-line-circle-medium" cx="221.999994913737" cy="36.15384615384615" r="3" style="stroke: rgb(33, 150, 243); fill: rgb(33, 150, 243); opacity: 1;"></circle>
                             <circle class="d3-line-circle d3-line-circle-medium" cx="262.3999938964844" cy="8.46153846153846" r="3" style="stroke: rgb(33, 150, 243); fill: rgb(33, 150, 243); opacity: 1;"></circle>
                         </g>
                     </g>
                 </svg>
             </div>
         </div>

    </div>
                <div class="col-lg-6 col-xl-6">
                    <div class="card card-body">
                        <div class="media align-items-center align-items-lg-start flex-column flex-lg-row">
                            <a href="#" class="text-teal mr-lg-3 mb-3 mb-lg-0 mt-1">
                                <i class="icon-gear text-primary border-primary border-2 rounded-pill p-2"></i>
                            </a>

                            <div class="media-body text-center text-lg-left">
                                <h5 class="media-title font-weight-normal">Ejecutar Nuevo Analisis</h5>
                                ultima ejecucion 25 may 2021
                            </div>

                            <a href="#" class="btn btn-success ml-lg-3 mt-3 mt-lg-1">Ejecutar</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>-->
    <!-- /simple statistics -->
    <!-- Simple statistics -->

    @foreach (var item in Model.Items)
    {
        <div class="mb-2">
            <div class="row">
                <div class="col-sm-12 col-xl-12">
                    <div class="card border-top-2 border-bottom-2 border-top-success border-bottom-success rounded-0">
                        <div class="page-header-content header-elements-lg-inline">
                            <div class="page-title d-flex breadcrumb pt-0 col-4">
                                <h4>@item.Search.Name</h4>
                            </div>
                            <div class="border-left border-left-success align-items-center p-1 text-center w-25">
                                <h2 class="font-weight-semibold m-0" id="CantAtributos">@item.Search.Executions.Count</h2>
                                <span class="font-weight-normal">EJECUCIONES</span>
                            </div>
                            <div class="border-left border-left-success align-items-center p-1 text-center w-25">
                                <h2 class="font-weight-semibold m-0" id="CantAtributos">@item.CantidadPublicaciones</h2>
                                <span class="font-weight-normal">PUBLICACIONES</span>
                            </div>
                            <div class="border-left border-left-success align-items-center p-1 text-center w-25">
                                <h2 class="font-weight-semibold m-0" id="CantAtributos">@item.CantidadVentas</h2>
                                <span class="font-weight-normal">VENTAS</span>
                            </div>
                            <div class="border-left border-left-success align-items-center p-1 text-center w-25">
                                <h2 class="font-weight-semibold m-0" id="CantAtributos">@item.CantidadCompetidores</h2>
                                <span class="font-weight-li">COMPETIDORES</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">

                <div class="col-sm-6 col-xl-3">
                    <div class="card card-body @item.TemperaturaCategoriaClase text-white has-bg-image">
                        <div class="media mb-3">
                            <div class="media-body">
                                <h6 class="font-weight-semibold mb-0">Analisis de oportunidad</h6>
                                <span class="opacity-75">Competidores fuertes</span>
                            </div>

                            <div class="ml-3 align-self-center">
                                <i class="icon-pulse2 icon-2x"></i>
                            </div>
                        </div>

                        <div class="progress @item.TemperaturaCategoriaClase mb-2" style="height: 0.3rem;">
                            <div class="progress-bar bg-white" style="width: @item.TemperaturaCategoriaPorcentaje%">
                                <span class="sr-only">@item.TemperaturaCategoriaPorcentaje% Complete</span>
                            </div>
                        </div>

                        <div>
                            <span class="float-right">@item.TemperaturaCategoriaPorcentaje%</span>
                            @item.TemperaturaCategoriaLeyenda
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <button type="button" class="btn btn-teal btn-block btn-float font-size-xs">
                                <i class="icon-file-plus icon-2x"></i>
                                <span>Nueva Ejecución</span>
                            </button>
                        </div> 
                        <div class="col-md-6">
                            <button type="button" class="btn btn-teal btn-block btn-float font-size-xs">
                                <i class="icon-file-plus icon-2x"></i>
                                <span>Ver Búsqueda</span>
                            </button>
                        </div>
                        </div>
                    </div>
                    <div class="col-sm-6 col-xl-3">
                        <div class="card card-body text-center">
                            <h6 class="font-weight-semibold mb-0 mt-1">Tipos de Competidores</h6>
                            <div class="svg-center" id="donutSellers_@item.Search.IdSearch"></div>
                        </div>
                    </div>
                    <div class="col-sm-6 col-xl-6">
                        <div class="card card-body text-center">
                            <h6 class="font-weight-semibold mb-0 mt-1">Relacion Precio Medio</h6>
                            <div class="svg-center" style="height:200px;" id="avgPrice_@item.Search.IdSearch"></div>
                        </div>
                    </div>
                </div>
        </div>
     }

    </div>

<script type="text/javascript">

    document.addEventListener('DOMContentLoaded', function () {
         @foreach (var item in Model.Items)
          {
             <text>
            _pieDonutSellers(@item.Search.IdSearch);
            _avgPriceLine(@item.Search.IdSearch);
             </text>
          }

    });

    function _pieDonutSellers(id) {
        $.post('/Home/GetSellersType', { searchId: id})
               .done(function (data) {
                   var info = []
                   $.each(data, function (key, value) {
                       var itemInfo = {
                           text: value.parameterName,
                           value: value.parameterValue,
                           color: colores[key]
                       };
                       info.push(itemInfo);
                   })
                   _pieDonutBasic('donutSellers_' + id, info);
                })
                .fail(function (e) {
                    $.jGrowl(e.responseText, { theme: 'growl-error', header: ' ERROR ', life: 3000 });
                });
    }

    function _avgPriceLine(id) {
        $.post('/Home/GetAvgPriceLine', { searchId: id })
            .done(function (data) {
                var info = [];
                if (data.xList.length == 1) {
                    $("#avgPrice_" + id).html("<span><u>Precio medio publicacion:</u> $" + parseFloat(data.dataSeries[0].yList[0]).toFixed(2) + "<br><u>Precio medio venta: </u> $" + parseFloat(data.dataSeries[1].yList[0]).toFixed(2));
                } else {
                    $.each(data.dataSeries, function (key, value) {
                        var itemInfo = {
                            name: value.legend,
                            type: 'line',
                            smooth: true,
                            symbolSize: 7,
                            data: value.yList,
                            itemStyle: {
                                normal: {
                                    borderWidth: 2
                                }
                            }
                        };
                        info.push(itemInfo);
                    })
                        _linesStacked('avgPrice_' + id, data.xList, data.dataLegend, info);
                }
            })
            .fail(function (e) {
                $.jGrowl(e.responseText, { theme: 'growl-error', header: ' ERROR ', life: 3000 });
            });
    }

</script>
